/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
*/
window.rangy123=function(){function b(a,f){var b=typeof a[f];return b==e||!(b!=I||!a[f])||"unknown"==b}function F(a,f){return!(typeof a[f]!=I||!a[f])}function E(a,f){return typeof a[f]!=p}function y(a){return function(f,b){for(var e=b.length;e--;)if(!a(f,b[e]))return!1;return!0}}function w(a){return a&&q(a,k)&&f(a,s)}function u(a){window.alert("Rangy not supported in your browser. Reason: "+a);v.initialized=!0;v.supported=!1}function A(){if(!v.initialized){var a,e=!1,p=!1;b(document,"createRange")&&
(a=document.createRange(),q(a,t)&&f(a,r)&&(e=!0),a.detach());(a=F(document,"body")?document.body:document.getElementsByTagName("body")[0])&&b(a,"createTextRange")&&(a=a.createTextRange(),w(a)&&(p=!0));e||p||u("Neither Range nor TextRange are implemented");v.initialized=!0;v.features={implementsDomRange:e,implementsTextRange:p};e=K.concat(x);p=0;for(a=e.length;p<a;++p)try{e[p](v)}catch(k){F(window,"console")&&b(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
k)}}}function z(a){this.name=a;this.supported=this.initialized=!1}var I="object",e="function",p="undefined",r="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),t="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
s="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),k="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),q=y(b),a=y(F),f=y(E),v={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:b,isHostObject:F,isHostProperty:E,areHostMethods:q,areHostObjects:a,areHostProperties:f,isTextRange:w},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
v.fail=u;v.warn=function(a){a="Rangy warning: "+a;v.config.alertOnWarn?window.alert(a):typeof window.console!=p&&typeof window.console.log!=p&&window.console.log(a)};({}).hasOwnProperty?v.util.extend=function(a,f){for(var e in f)f.hasOwnProperty(e)&&(a[e]=f[e])}:u("hasOwnProperty not supported");var x=[],K=[];v.init=A;v.addInitListener=function(a){v.initialized?a(v):x.push(a)};var H=[];v.addCreateMissingNativeApiListener=function(a){H.push(a)};v.createMissingNativeApi=function(a){a=a||window;A();
for(var f=0,e=H.length;f<e;++f)H[f](a)};z.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};z.prototype.warn=function(a){v.warn("Module "+this.name+": "+a)};z.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};v.createModule=function(a,f){var e=new z(a);v.modules[a]=e;K.push(function(a){f(a,e);e.initialized=!0;e.supported=!0})};v.requireModules=function(a){for(var f=0,e=a.length,b,p;f<
e;++f){p=a[f];b=v.modules[p];if(!(b&&b instanceof z))throw Error("Module '"+p+"' not found");if(!b.supported)throw Error("Module '"+p+"' not supported");}};var G=!1,a=function(a){G||(G=!0,v.initialized||A())};if(typeof window==p)u("No window found");else if(typeof document==p)u("No document found");else return b(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",a,!1),b(window,"addEventListener")?window.addEventListener("load",a,!1):b(window,"attachEvent")?window.attachEvent("onload",
a):u("Window does not have required addEventListener or attachEvent method"),v}();
rangy123.createModule("DomUtil",function(b,F){function E(a){for(var f=0;a=a.previousSibling;)f++;return f}function y(a,f){var e=[],b;for(b=a;b;b=b.parentNode)e.push(b);for(b=f;b;b=b.parentNode)if(q(e,b))return b;return null}function w(a,f,e){for(e=e?a:a.parentNode;e;){a=e.parentNode;if(a===f)return e;e=a}return null}function u(a){a=a.nodeType;return 3==a||4==a||8==a}function A(a,f){var e=f.nextSibling,b=f.parentNode;e?b.insertBefore(a,e):b.appendChild(a);return a}function z(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=t)return a.ownerDocument;if(typeof a.document!=t)return a.document;if(a.parentNode)return z(a.parentNode);throw Error("getDocument: no document found for node");}function I(a){return a?u(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName:"[No node]"}function e(a){this._next=this.root=a}function p(a,f){this.node=a;this.offset=f}function r(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var t="undefined",s=b.util;s.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||F.fail("document missing a Node creation method");s.isHostMethod(document,"getElementsByTagName")||F.fail("document missing getElementsByTagName method");var k=document.createElement("div");s.areHostMethods(k,["insertBefore","appendChild","cloneNode"])||F.fail("Incomplete Element implementation");s.isHostProperty(k,"innerHTML")||F.fail("Element is missing innerHTML property");k=document.createTextNode("test");
s.areHostMethods(k,["splitText","deleteData","insertData","appendData","cloneNode"])||F.fail("Incomplete Text Node implementation");var q=function(a,f){for(var e=a.length;e--;)if(a[e]===f)return!0;return!1};e.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,f;if(this._current){f=a.firstChild;if(!f)for(f=null;a!==this.root&&!(f=a.nextSibling);)a=a.parentNode;this._next=f}return this._current},detach:function(){this._current=this._next=this.root=
null}};p.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+I(this.node)+":"+this.offset+")]"}};r.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};r.prototype.toString=function(){return this.message};b.dom={arrayContains:q,isHtmlNamespace:function(a){var f;return typeof a.namespaceURI==t||null===(f=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
f},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:E,getNodeLength:function(a){var f;return u(a)?a.length:(f=a.childNodes)?f.length:0},getCommonAncestor:y,isAncestorOf:function(a,f,e){for(f=e?f:f.parentNode;f;){if(f===a)return!0;f=f.parentNode}return!1},getClosestAncestorIn:w,isCharacterDataNode:u,insertAfter:A,splitDataNode:function(a,f){var e=a.cloneNode(!1);e.deleteData(0,f);a.deleteData(f,a.length-f);A(e,a);return e},getDocument:z,getWindow:function(a){a=z(a);
if(typeof a.defaultView!=t)return a.defaultView;if(typeof a.parentWindow!=t)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=t)return a.contentWindow;if(typeof a.contentDocument!=t)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=t)return a.contentDocument;if(typeof a.contentWindow!=t)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return s.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var f;f=a.parentNode;)a=f;return a},comparePoints:function(a,f,e,b){var p;if(a==e)return f===b?0:f<b?-1:1;if(p=w(e,a,!0))return f<=E(p)?-1:1;if(p=w(a,e,!0))return E(p)<b?-1:1;f=y(a,e);a=a===f?f:w(a,f,!0);e=e===f?f:w(e,f,!0);if(a===e)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(f=f.firstChild;f;){if(f===a)return-1;if(f===e)return 1;f=f.nextSibling}throw Error("Should not be here!");},inspectNode:I,fragmentFromNodeChildren:function(a){for(var e=z(a).createDocumentFragment(),b;b=a.firstChild;)e.appendChild(b);return e},createIterator:function(a){return new e(a)},DomPosition:p};b.DOMException=r});
rangy123.createModule("DomRange",function(b,F){function E(n,a){return 3!=n.nodeType&&(h.isAncestorOf(n,a.startContainer,!0)||h.isAncestorOf(n,a.endContainer,!0))}function y(n){return h.getDocument(n.startContainer)}function w(n,a,g){if(a=n._listeners[a])for(var c=0,l=a.length;c<l;++c)a[c].call(n,{target:n,args:g})}function u(n){return new R(n.parentNode,h.getNodeIndex(n))}function A(n){return new R(n.parentNode,h.getNodeIndex(n)+1)}function z(n,a,g){var c=11==n.nodeType?n.firstChild:n;h.isCharacterDataNode(a)?
g==a.length?h.insertAfter(n,a):a.parentNode.insertBefore(n,0==g?a:h.splitDataNode(a,g)):g>=a.childNodes.length?a.appendChild(n):a.insertBefore(n,a.childNodes[g]);return c}function I(n){for(var a,g,c=y(n.range).createDocumentFragment();g=n.next();){a=n.isPartiallySelectedSubtree();g=g.cloneNode(!a);a&&(a=n.getSubtreeIterator(),g.appendChild(I(a)),a.detach(!0));if(10==g.nodeType)throw new J("HIERARCHY_REQUEST_ERR");c.appendChild(g)}return c}function e(n,a,g){var c,l;for(g=g||{stop:!1};c=n.next();)if(n.isPartiallySelectedSubtree())if(!1===
a(c)){g.stop=!0;break}else{if(c=n.getSubtreeIterator(),e(c,a,g),c.detach(!0),g.stop)break}else for(c=h.createIterator(c);l=c.next();)if(!1===a(l)){g.stop=!0;return}}function p(n){for(var a;n.next();)n.isPartiallySelectedSubtree()?(a=n.getSubtreeIterator(),p(a),a.detach(!0)):n.remove()}function r(n){for(var a,g=y(n.range).createDocumentFragment(),c;a=n.next();){n.isPartiallySelectedSubtree()?(a=a.cloneNode(!1),c=n.getSubtreeIterator(),a.appendChild(r(c)),c.detach(!0)):n.remove();if(10==a.nodeType)throw new J("HIERARCHY_REQUEST_ERR");
g.appendChild(a)}return g}function t(n,a,g){var c=!(!a||!a.length),l,d=!!g;c&&(l=RegExp("^("+a.join("|")+")$"));var f=[];e(new k(n,!1),function(a){c&&!l.test(a.nodeType)||d&&!g(a)||f.push(a)});return f}function s(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+h.inspectNode(a.startContainer)+":"+a.startOffset+", "+h.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function k(a,g){this.range=a;this.clonePartiallySelectedTextNodes=g;if(!a.collapsed){this.sc=a.startContainer;this.so=
a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||h.isCharacterDataNode(this.sc)?h.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||h.isCharacterDataNode(this.ec)?h.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function q(a){this.code=this[a];
this.codeName=a;this.message="RangeException: "+this.codeName}function a(a,g,c){this.nodes=t(a,g,c);this._next=this.nodes[0];this._position=0}function f(a){return function(g,c){for(var l,d=c?g:g.parentNode;d;){l=d.nodeType;if(h.arrayContains(a,l))return d;d=d.parentNode}return null}}function v(a,g){if(fa(a,g))throw new q("INVALID_NODE_TYPE_ERR");}function x(a){if(!a.startContainer)throw new J("INVALID_STATE_ERR");}function K(a,g){if(!h.arrayContains(g,a.nodeType))throw new q("INVALID_NODE_TYPE_ERR");
}function H(a,g){if(0>g||g>(h.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new J("INDEX_SIZE_ERR");}function G(a,g){if(V(a,!0)!==V(g,!0))throw new J("WRONG_DOCUMENT_ERR");}function B(a){if(ga(a,!0))throw new J("NO_MODIFICATION_ALLOWED_ERR");}function L(a,g){if(!a)throw new J(g);}function P(a){return!!a.startContainer&&!!a.endContainer&&!(!h.arrayContains(Q,a.startContainer.nodeType)&&!V(a.startContainer,!0))&&!(!h.arrayContains(Q,a.endContainer.nodeType)&&!V(a.endContainer,!0))&&a.startOffset<=
(h.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length)&&a.endOffset<=(h.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)}function C(a){x(a);if(!P(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function N(){}function M(a){a.START_TO_START=W;a.START_TO_END=$;a.END_TO_END=ha;a.END_TO_START=aa;a.NODE_BEFORE=ba;a.NODE_AFTER=ca;a.NODE_BEFORE_AND_AFTER=da;a.NODE_INSIDE=
X}function c(a){M(a);M(a.prototype)}function d(a,g){return function(){C(this);var c=this.startContainer,l=this.startOffset,d=this.commonAncestorContainer,f=new k(this,!0);c!==d&&(c=h.getClosestAncestorIn(c,d,!0),l=A(c),c=l.node,l=l.offset);e(f,B);f.reset();d=a(f);f.detach();g(this,c,l,c,l);return d}}function D(a,g,l){function e(a,g){return function(c){x(this);K(c,S);K(T(c),Q);c=(a?u:A)(c);(g?f:D)(this,c.node,c.offset)}}function f(a,c,n){var l=a.endContainer,d=a.endOffset;if(c!==a.startContainer||
n!==a.startOffset){if(T(c)!=T(l)||1==h.comparePoints(c,n,l,d))l=c,d=n;g(a,c,n,l,d)}}function D(a,c,n){var l=a.startContainer,d=a.startOffset;if(c!==a.endContainer||n!==a.endOffset){if(T(c)!=T(l)||-1==h.comparePoints(c,n,l,d))l=c,d=n;g(a,l,d,c,n)}}a.prototype=new N;b.util.extend(a.prototype,{setStart:function(a,g){x(this);v(a,!0);H(a,g);f(this,a,g)},setEnd:function(a,g){x(this);v(a,!0);H(a,g);D(this,a,g)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){C(this);
a?g(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):g(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){x(this);v(a,!0);g(this,a,0,a,h.getNodeLength(a))},selectNode:function(a){x(this);v(a,!1);K(a,S);var c=u(a);a=A(a);g(this,c.node,c.offset,a.node,a.offset)},extractContents:d(r,g),deleteContents:d(p,g),canSurroundContents:function(){C(this);B(this.startContainer);B(this.endContainer);var a=new k(this,!0),g=a._first&&
E(a._first,this)||a._last&&E(a._last,this);a.detach();return!g},detach:function(){l(this)},splitBoundaries:function(){C(this);var a=this.startContainer,c=this.startOffset,n=this.endContainer,l=this.endOffset,d=a===n;h.isCharacterDataNode(n)&&(0<l&&l<n.length)&&h.splitDataNode(n,l);h.isCharacterDataNode(a)&&(0<c&&c<a.length)&&(a=h.splitDataNode(a,c),d?(l-=c,n=a):n==a.parentNode&&l>=h.getNodeIndex(a)&&l++,c=0);g(this,a,c,n,l)},normalizeBoundaries:function(){C(this);var a=this.startContainer,c=this.startOffset,
n=this.endContainer,l=this.endOffset,d=function(a){var g=a.nextSibling;g&&g.nodeType==a.nodeType&&(n=a,l=a.length,a.appendData(g.data),g.parentNode.removeChild(g))},e=function(g){var d=g.previousSibling;if(d&&d.nodeType==g.nodeType){a=g;var e=g.length;c=d.length;g.insertData(0,d.data);d.parentNode.removeChild(d);a==n?(l+=c,n=a):n==g.parentNode&&(d=h.getNodeIndex(g),l==d?(n=g,l=e):l>d&&l--)}},f=!0;h.isCharacterDataNode(n)?n.length==l&&d(n):(0<l&&(f=n.childNodes[l-1])&&h.isCharacterDataNode(f)&&d(f),
f=!this.collapsed);f?h.isCharacterDataNode(a)?0==c&&e(a):c<a.childNodes.length&&(d=a.childNodes[c])&&h.isCharacterDataNode(d)&&e(d):(a=n,c=l);g(this,a,c,n,l)},collapseToPoint:function(a,c){x(this);v(a,!0);H(a,c);a===this.startContainer&&c===this.startOffset&&a===this.endContainer&&c===this.endOffset||g(this,a,c,a,c)}});c(a)}function U(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:h.getCommonAncestor(a.startContainer,
a.endContainer)}function O(a,g,c,l,d){var e=a.startContainer!==g||a.startOffset!==c,f=a.endContainer!==l||a.endOffset!==d;a.startContainer=g;a.startOffset=c;a.endContainer=l;a.endOffset=d;U(a);w(a,"boundarychange",{startMoved:e,endMoved:f})}function m(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};U(this)}b.requireModules(["DomUtil"]);var h=b.dom,R=h.DomPosition,J=b.DOMException;k.prototype={_current:null,_next:null,_first:null,
_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,h.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,g,c;!h.isCharacterDataNode(a)||
a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(g=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,g!=c&&a.deleteData(g,c-g))},isPartiallySelectedSubtree:function(){return E(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new m(y(this.range));var g=this._current,c=g,l=0,d=g,e=h.getNodeLength(g);h.isAncestorOf(g,this.sc,!0)&&(c=this.sc,l=this.so);h.isAncestorOf(g,this.ec,!0)&&(d=this.ec,
e=this.eo);O(a,c,l,d,e)}return new k(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};q.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};q.prototype.toString=function(){return this.message};a.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},
detach:function(){this._current=this._next=this.nodes=null}};var S=[1,3,4,5,7,8,10],Q=[2,9,11],g=[1,3,4,5,7,8,10,11],l=[1,3,4,5,7,8],T=h.getRootContainer,V=f([9,11]),ga=f([5,6,10,12]),fa=f([6,10,12]),ea=document.createElement("style"),Y=!1;try{ea.innerHTML="<b>x</b>",Y=3==ea.firstChild.nodeType}catch(ia){}b.features.htmlParsingConforms=Y;var Z="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),W=0,$=1,ha=2,aa=3,ba=0,ca=1,da=2,X=3;N.prototype={attachListener:function(a,
g){this._listeners[a].push(g)},compareBoundaryPoints:function(a,g){C(this);G(this.startContainer,g.startContainer);var c=a==aa||a==W?"start":"end",l=a==$||a==W?"start":"end";return h.comparePoints(this[c+"Container"],this[c+"Offset"],g[l+"Container"],g[l+"Offset"])},insertNode:function(a){C(this);K(a,g);B(this.startContainer);if(h.isAncestorOf(a,this.startContainer,!0))throw new J("HIERARCHY_REQUEST_ERR");a=z(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){C(this);
var a,g;if(this.collapsed)return y(this).createDocumentFragment();if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),g=y(this).createDocumentFragment(),g.appendChild(a),g;g=new k(this,!0);a=I(g);g.detach();return a},canSurroundContents:function(){C(this);B(this.startContainer);B(this.endContainer);var a=new k(this,!0),g=a._first&&E(a._first,this)||a._last&&E(a._last,
this);a.detach();return!g},surroundContents:function(a){K(a,l);if(!this.canSurroundContents())throw new q("BAD_BOUNDARYPOINTS_ERR");var g=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);z(a,this.startContainer,this.startOffset);a.appendChild(g);this.selectNode(a)},cloneRange:function(){C(this);for(var a=new m(y(this)),g=Z.length,c;g--;)c=Z[g],a[c]=this[c];return a},toString:function(){C(this);var a=this.startContainer;if(a===this.endContainer&&h.isCharacterDataNode(a))return 3==
a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var g=[],a=new k(this,!0);e(a,function(a){3!=a.nodeType&&4!=a.nodeType||g.push(a.data)});a.detach();return g.join("")},compareNode:function(a){C(this);var g=a.parentNode,c=h.getNodeIndex(a);if(!g)throw new J("NOT_FOUND_ERR");a=this.comparePoint(g,c);g=this.comparePoint(g,c+1);return 0>a?0<g?da:ba:0<g?ca:X},comparePoint:function(a,g){C(this);L(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0>h.comparePoints(a,g,
this.startContainer,this.startOffset)?-1:0<h.comparePoints(a,g,this.endContainer,this.endOffset)?1:0},createContextualFragment:Y?function(a){var g=this.startContainer,c=h.getDocument(g);if(!g)throw new J("INVALID_STATE_ERR");var l=null;1==g.nodeType?l=g:h.isCharacterDataNode(g)&&(l=h.parentElement(g));l=null===l||"HTML"==l.nodeName&&h.isHtmlNamespace(h.getDocument(l).documentElement)&&h.isHtmlNamespace(l)?c.createElement("body"):l.cloneNode(!1);l.innerHTML=a;return h.fragmentFromNodeChildren(l)}:
function(a){x(this);var g=y(this).createElement("body");g.innerHTML=a;return h.fragmentFromNodeChildren(g)},toHtml:function(){C(this);var a=y(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,g){C(this);L(a,"NOT_FOUND_ERR");if(h.getDocument(a)!==y(this))return!1;var c=a.parentNode,l=h.getNodeIndex(a);L(c,"NOT_FOUND_ERR");var d=h.comparePoints(c,l,this.endContainer,this.endOffset),c=h.comparePoints(c,l+1,this.startContainer,this.startOffset);
return g?0>=d&&0<=c:0>d&&0<c},isPointInRange:function(a,g){C(this);L(a,"HIERARCHY_REQUEST_ERR");G(a,this.startContainer);return 0<=h.comparePoints(a,g,this.startContainer,this.startOffset)&&0>=h.comparePoints(a,g,this.endContainer,this.endOffset)},intersectsRange:function(a,g){C(this);if(y(a)!=y(this))throw new J("WRONG_DOCUMENT_ERR");var c=h.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),l=h.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);
return g?0>=c&&0<=l:0>c&&0<l},intersection:function(a){if(this.intersectsRange(a)){var g=h.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=h.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),l=this.cloneRange();-1==g&&l.setStart(a.startContainer,a.startOffset);1==c&&l.setEnd(a.endContainer,a.endOffset);return l}return null},union:function(a){if(this.intersectsRange(a,!0)){var g=this.cloneRange();-1==h.comparePoints(a.startContainer,a.startOffset,
this.startContainer,this.startOffset)&&g.setStart(a.startContainer,a.startOffset);1==h.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&g.setEnd(a.endContainer,a.endOffset);return g}throw new q("Ranges do not intersect");},containsNode:function(a,g){return g?this.intersectsNode(a,!1):this.compareNode(a)==X},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,h.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},
containsNodeText:function(a){var g=this.cloneRange();g.selectNode(a);var c=g.getNodes([3]);return 0<c.length?(g.setStart(c[0],0),a=c.pop(),g.setEnd(a,a.length),a=this.containsRange(g),g.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(g,c){C(this);return new a(this,g,c)},getNodes:function(a,g){C(this);return t(this,a,g)},getDocument:function(){return y(this)},collapseBefore:function(a){x(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){x(this);this.setStartAfter(a);
this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return m.rangesEqual(this,a)},isValid:function(){return P(this)},inspect:function(){return s(this)}};D(m,O,function(a){x(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;w(a,"detach",null);a._listeners=null});b.rangePrototype=N.prototype;m.rangeProperties=Z;m.RangeIterator=k;m.copyComparisonConstants=c;m.createPrototypeRange=D;m.inspect=s;m.getRangeDocument=y;m.rangesEqual=
function(a,g){return a.startContainer===g.startContainer&&a.startOffset===g.startOffset&&a.endContainer===g.endContainer&&a.endOffset===g.endOffset};b.DomRange=m;b.RangeException=q});
rangy123.createModule("WrappedRange",function(b,F){function E(e,b,r,t){var s=e.duplicate();s.collapse(r);var k=s.parentElement();u.isAncestorOf(b,k,!0)||(k=b);if(!k.canHaveHTML)return new A(k.parentNode,u.getNodeIndex(k));b=u.getDocument(k).createElement("span");var q,a=r?"StartToStart":"StartToEnd";do k.insertBefore(b,b.previousSibling),s.moveToElementText(b);while(0<(q=s.compareEndPoints(a,e))&&b.previousSibling);a=b.nextSibling;if(-1==q&&a&&u.isCharacterDataNode(a)){s.setEndPoint(r?"EndToStart":
"EndToEnd",e);if(/[\r\n]/.test(a.data))for(k=s.duplicate(),r=k.text.replace(/\r\n/g,"\r").length,r=k.moveStart("character",r);-1==k.compareEndPoints("StartToEnd",k);)r++,k.moveStart("character",1);else r=s.text.length;k=new A(a,r)}else a=(t||!r)&&b.previousSibling,k=(r=(t||r)&&b.nextSibling)&&u.isCharacterDataNode(r)?new A(r,0):a&&u.isCharacterDataNode(a)?new A(a,a.length):new A(k,u.getNodeIndex(b));b.parentNode.removeChild(b);return k}function y(e,b){var r,t,s=e.offset,k=u.getDocument(e.node),q=
k.body.createTextRange(),a=u.isCharacterDataNode(e.node);a?(r=e.node,t=r.parentNode):(r=e.node.childNodes,r=s<r.length?r[s]:null,t=e.node);k=k.createElement("span");k.innerHTML="&#feff;";r?t.insertBefore(k,r):t.appendChild(k);q.moveToElementText(k);q.collapse(!b);t.removeChild(k);if(a)q[b?"moveStart":"moveEnd"]("character",s);return q}b.requireModules(["DomUtil","DomRange"]);var w,u=b.dom,A=u.DomPosition,z=b.DomRange;if(b.features.implementsDomRange&&(!b.features.implementsTextRange||!b.config.preferTextRange))(function(){function e(a){for(var e=
r.length,b;e--;)b=r[e],a[b]=a.nativeRange[b]}var p,r=z.rangeProperties,t;w=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;e(this)};z.createPrototypeRange(w,function(a,e,b,p,k){var q=a.endContainer!==p||a.endOffset!=k;if(a.startContainer!==e||a.startOffset!=b||q)a.setEnd(p,k),a.setStart(e,b)},function(a){a.nativeRange.detach();a.detached=!0;for(var e=r.length,b;e--;)b=r[e],a[b]=null});p=w.prototype;p.selectNode=function(a){this.nativeRange.selectNode(a);e(this)};p.deleteContents=
function(){this.nativeRange.deleteContents();e(this)};p.extractContents=function(){var a=this.nativeRange.extractContents();e(this);return a};p.cloneContents=function(){return this.nativeRange.cloneContents()};p.surroundContents=function(a){this.nativeRange.surroundContents(a);e(this)};p.collapse=function(a){this.nativeRange.collapse(a);e(this)};p.cloneRange=function(){return new w(this.nativeRange.cloneRange())};p.refresh=function(){e(this)};p.toString=function(){return this.nativeRange.toString()};
var s=document.createTextNode("test");u.getBody(document).appendChild(s);var k=document.createRange();k.setStart(s,0);k.setEnd(s,0);try{k.setStart(s,1),p.setStart=function(a,b){this.nativeRange.setStart(a,b);e(this)},p.setEnd=function(a,b){this.nativeRange.setEnd(a,b);e(this)},t=function(a){return function(b){this.nativeRange[a](b);e(this)}}}catch(q){p.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(p){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}e(this)},p.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(p){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}e(this)},t=function(a,b){return function(p){try{this.nativeRange[a](p)}catch(k){this.nativeRange[b](p),this.nativeRange[a](p)}e(this)}}}p.setStartBefore=t("setStartBefore","setEndBefore");p.setStartAfter=t("setStartAfter","setEndAfter");p.setEndBefore=t("setEndBefore","setStartBefore");p.setEndAfter=t("setEndAfter","setStartAfter");k.selectNodeContents(s);p.selectNodeContents=k.startContainer==
s&&k.endContainer==s&&0==k.startOffset&&k.endOffset==s.length?function(a){this.nativeRange.selectNodeContents(a);e(this)}:function(a){this.setStart(a,0);this.setEnd(a,z.getEndOffset(a))};k.selectNodeContents(s);k.setEnd(s,3);t=document.createRange();t.selectNodeContents(s);t.setEnd(s,4);t.setStart(s,2);-1==k.compareBoundaryPoints(k.START_TO_END,t)&1==k.compareBoundaryPoints(k.END_TO_START,t)?p.compareBoundaryPoints=function(a,e){e=e.nativeRange||e;a==e.START_TO_END?a=e.END_TO_START:a==e.END_TO_START&&
(a=e.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,e)}:p.compareBoundaryPoints=function(a,e){return this.nativeRange.compareBoundaryPoints(a,e.nativeRange||e)};b.util.isHostMethod(k,"createContextualFragment")&&(p.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});u.getBody(document).removeChild(s);k.detach();t.detach()})(),b.createNativeRange=function(e){e=e||document;return e.createRange()};else if(b.features.implementsTextRange){w=function(e){this.textRange=
e;this.refresh()};w.prototype=new z(document);w.prototype.refresh=function(){var e,b,r=this.textRange;e=r.parentElement();var t=r.duplicate();t.collapse(!0);b=t.parentElement();t=r.duplicate();t.collapse(!1);r=t.parentElement();b=b==r?b:u.getCommonAncestor(b,r);b=b==e?b:u.getCommonAncestor(e,b);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?b=e=E(this.textRange,b,!0,!0):(e=E(this.textRange,b,!0,!1),b=E(this.textRange,b,!1,!1));this.setStart(e.node,e.offset);this.setEnd(b.node,b.offset)};
z.copyComparisonConstants(w);var I=function(){return this}();"undefined"==typeof I.Range&&(I.Range=w);b.createNativeRange=function(e){e=e||document;return e.body.createTextRange()}}b.features.implementsTextRange&&(w.rangeToTextRange=function(e){if(e.collapsed)return y(new A(e.startContainer,e.startOffset),!0);var b=y(new A(e.startContainer,e.startOffset),!0),r=y(new A(e.endContainer,e.endOffset),!1);e=u.getDocument(e.startContainer).body.createTextRange();e.setEndPoint("StartToStart",b);e.setEndPoint("EndToEnd",
r);return e});w.prototype.getName=function(){return"WrappedRange"};b.WrappedRange=w;b.createRange=function(e){e=e||document;return new w(b.createNativeRange(e))};b.createRangyRange=function(b){b=b||document;return new z(b)};b.createIframeRange=function(e){return b.createRange(u.getIframeDocument(e))};b.createIframeRangyRange=function(e){return b.createRangyRange(u.getIframeDocument(e))};b.addCreateMissingNativeApiListener(function(e){e=e.document;"undefined"==typeof e.createRange&&(e.createRange=
function(){return b.createRange(this)});e=e=null})});
rangy123.createModule("WrappedSelection",function(b,F){function E(a){return(a||window).getSelection()}function y(a){return(a||window).document.selection}function w(a,c,d){var b=d?"end":"start";d=d?"start":"end";a.anchorNode=c[b+"Container"];a.anchorOffset=c[b+"Offset"];a.focusNode=c[d+"Container"];a.focusOffset=c[d+"Offset"]}function u(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function A(a){var c;a instanceof f?(c=a._selectionNativeRange,
c||(c=b.createNativeRange(q.getDocument(a.startContainer)),c.setEnd(a.endContainer,a.endOffset),c.setStart(a.startContainer,a.startOffset),a._selectionNativeRange=c,a.attachListener("detach",function(){this._selectionNativeRange=null}))):a instanceof v?c=a.nativeRange:b.features.implementsDomRange&&a instanceof q.getWindow(a.startContainer).Range&&(c=a);return c}function z(a){var c=a.getNodes(),d;a:if(c.length&&1==c[0].nodeType){d=1;for(var b=c.length;d<b;++d)if(!q.isAncestorOf(c[0],c[d])){d=!1;break a}d=
!0}else d=!1;if(!d)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function I(a,c){var d=new v(c);a._ranges=[d];w(a,d,!1);a.rangeCount=1;a.isCollapsed=d.collapsed}function e(a){a._ranges.length=0;if("None"==a.docSelection.type)u(a);else{var c=a.docSelection.createRange();if(c&&"undefined"!=typeof c.text)I(a,c);else{a.rangeCount=c.length;for(var d,e=q.getDocument(c.item(0)),f=0;f<a.rangeCount;++f)d=b.createRange(e),d.selectNode(c.item(f)),
a._ranges.push(d);a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed;w(a,a._ranges[a.rangeCount-1],!1)}}}function p(a,c){for(var d=a.docSelection.createRange(),b=z(c),f=q.getDocument(d.item(0)),f=q.getBody(f).createControlRange(),D=0,h=d.length;D<h;++D)f.add(d.item(D));try{f.add(b)}catch(m){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}f.select();e(a)}function r(a,c,d){this.nativeSelection=a;this.docSelection=c;this._ranges=
[];this.win=d;this.refresh()}function t(a,c){for(var d=q.getDocument(c[0].startContainer),d=q.getBody(d).createControlRange(),b=0,f;b<rangeCount;++b){f=z(c[b]);try{d.add(f)}catch(D){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();e(a)}function s(a,c){if(a.anchorNode&&q.getDocument(a.anchorNode)!==q.getDocument(c))throw new x("WRONG_DOCUMENT_ERR");}function k(a){var c=[],d=new K(a.anchorNode,a.anchorOffset),
b=new K(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var D=0,h=a.rangeCount;D<h;++D)c[D]=f.inspect(a.getRangeAt(D));return"["+e+"(Ranges: "+c.join(", ")+")(anchor: "+d.inspect()+", focus: "+b.inspect()+"]"}b.requireModules(["DomUtil","DomRange","WrappedRange"]);b.config.checkSelectionRanges=!0;var q=b.dom,a=b.util,f=b.DomRange,v=b.WrappedRange,x=b.DOMException,K=q.DomPosition,H,G,B=b.util.isHostMethod(window,"getSelection"),
L=b.util.isHostObject(document,"selection"),P=L&&(!B||b.config.preferTextRange);P?(H=y,b.isSelectionValid=function(a){a=(a||window).document;var c=a.selection;return"None"!=c.type||q.getDocument(c.createRange().parentElement())==a}):B?(H=E,b.isSelectionValid=function(){return!0}):F.fail("Neither document.selection or window.getSelection() detected.");b.getNativeSelection=H;var B=H(),C=b.createNativeRange(document),N=q.getBody(document),M=a.areHostObjects(B,a.areHostProperties(B,["anchorOffset","focusOffset"]));
b.features.selectionHasAnchorAndFocus=M;var c=a.isHostMethod(B,"extend");b.features.selectionHasExtend=c;var d="number"==typeof B.rangeCount;b.features.selectionHasRangeCount=d;var D=!1,U=!0;a.areHostMethods(B,["addRange","getRangeAt","removeAllRanges"])&&("number"==typeof B.rangeCount&&b.features.implementsDomRange)&&function(){var a=document.createElement("iframe");a.frameBorder=0;a.style.position="absolute";a.style.left="-10000px";N.appendChild(a);var c=q.getIframeDocument(a);c.open();c.write("<html><head></head><body>12</body></html>");
c.close();var d=q.getIframeWindow(a).getSelection(),b=c.documentElement.lastChild.firstChild,c=c.createRange();c.setStart(b,1);c.collapse(!0);d.addRange(c);U=1==d.rangeCount;d.removeAllRanges();var e=c.cloneRange();c.setStart(b,0);e.setEnd(b,2);d.addRange(c);d.addRange(e);D=2==d.rangeCount;c.detach();e.detach();N.removeChild(a)}();b.features.selectionSupportsMultipleRanges=D;b.features.collapsedNonEditableSelectionsSupported=U;var O=!1,m;N&&a.isHostMethod(N,"createControlRange")&&(m=N.createControlRange(),
a.areHostProperties(m,["item","add"])&&(O=!0));b.features.implementsControlRange=O;G=M?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var h;a.isHostMethod(B,"getRangeAt")?h=function(a,c){try{return a.getRangeAt(c)}catch(d){return null}}:M&&(h=function(a){var c=q.getDocument(a.anchorNode),c=b.createRange(c);c.setStart(a.anchorNode,a.anchorOffset);c.setEnd(a.focusNode,a.focusOffset);c.collapsed!==
this.isCollapsed&&(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,a.anchorOffset));return c});b.getSelection=function(a){a=a||window;var c=a._rangySelection,d=H(a),b=L?y(a):null;c?(c.nativeSelection=d,c.docSelection=b,c.refresh(a)):(c=new r(d,b,a),a._rangySelection=c);return c};b.getIframeSelection=function(a){return b.getSelection(q.getIframeWindow(a))};m=r.prototype;if(!P&&M&&a.areHostMethods(B,["removeAllRanges","addRange"])){m.removeAllRanges=function(){this.nativeSelection.removeAllRanges();
u(this)};var R=function(a,c){var d=f.getRangeDocument(c),d=b.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);a.nativeSelection.addRange(A(d));a.nativeSelection.extend(c.startContainer,c.startOffset);a.refresh()};m.addRange=d?function(a,d){if(O&&L&&"Control"==this.docSelection.type)p(this,a);else if(d&&c)R(this,a);else{var e;D?e=this.rangeCount:(this.removeAllRanges(),e=0);this.nativeSelection.addRange(A(a));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==e+1?(b.config.checkSelectionRanges&&
(e=h(this.nativeSelection,this.rangeCount-1))&&!f.rangesEqual(e,a)&&(a=new v(e)),this._ranges[this.rangeCount-1]=a,w(this,a,Q(this.nativeSelection)),this.isCollapsed=G(this)):this.refresh()}}:function(a,d){d&&c?R(this,a):(this.nativeSelection.addRange(A(a)),this.refresh())};m.setRanges=function(a){if(O&&1<a.length)t(this,a);else{this.removeAllRanges();for(var c=0,d=a.length;c<d;++c)this.addRange(a[c])}}}else if(a.isHostMethod(B,"empty")&&a.isHostMethod(C,"select")&&O&&P)m.removeAllRanges=function(){try{if(this.docSelection.empty(),
"None"!=this.docSelection.type){var a;if(this.anchorNode)a=q.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var c=this.docSelection.createRange();c.length&&(a=q.getDocument(c.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(d){}u(this)},m.addRange=function(a){"Control"==this.docSelection.type?p(this,a):(v.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,w(this,
a,!1))},m.setRanges=function(a){this.removeAllRanges();var c=a.length;1<c?t(this,a):c&&this.addRange(a[0])};else return F.fail("No means of selecting a Range or TextRange was found"),!1;m.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new x("INDEX_SIZE_ERR");return this._ranges[a]};var J;if(P)J=function(a){var c;b.isSelectionValid(a.win)?c=a.docSelection.createRange():(c=q.getBody(a.win.document).createTextRange(),c.collapse(!0));"Control"==a.docSelection.type?e(a):c&&"undefined"!=typeof c.text?
I(a,c):u(a)};else if(a.isHostMethod(B,"getRangeAt")&&"number"==typeof B.rangeCount)J=function(a){if(O&&L&&"Control"==a.docSelection.type)e(a);else if(a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount,a.rangeCount){for(var c=0,d=a.rangeCount;c<d;++c)a._ranges[c]=new b.WrappedRange(a.nativeSelection.getRangeAt(c));w(a,a._ranges[a.rangeCount-1],Q(a.nativeSelection));a.isCollapsed=G(a)}else u(a)};else if(M&&"boolean"==typeof B.isCollapsed&&"boolean"==typeof C.collapsed&&b.features.implementsDomRange)J=
function(a){var c;c=a.nativeSelection;c.anchorNode?(c=h(c,0),a._ranges=[c],a.rangeCount=1,c=a.nativeSelection,a.anchorNode=c.anchorNode,a.anchorOffset=c.anchorOffset,a.focusNode=c.focusNode,a.focusOffset=c.focusOffset,a.isCollapsed=G(a)):u(a)};else return F.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;m.refresh=function(a){var c=a?this._ranges.slice(0):null;J(this);if(a){a=c.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!f.rangesEqual(c[a],this._ranges[a]))return!1;
return!0}};var S=function(a,c){var d=a.getAllRanges(),b=!1;a.removeAllRanges();for(var e=0,f=d.length;e<f;++e)b||c!==d[e]?a.addRange(d[e]):b=!0;a.rangeCount||u(a)};m.removeRange=O?function(a){if("Control"==this.docSelection.type){var c=this.docSelection.createRange();a=z(a);for(var d=q.getDocument(c.item(0)),d=q.getBody(d).createControlRange(),b,f=!1,D=0,h=c.length;D<h;++D)b=c.item(D),b!==a||f?d.add(c.item(D)):f=!0;d.select();e(this)}else S(this,a)}:function(a){S(this,a)};var Q;!P&&M&&b.features.implementsDomRange?
(Q=function(a){var c=!1;a.anchorNode&&(c=1==q.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return c},m.isBackwards=function(){return Q(this)}):Q=m.isBackwards=function(){return!1};m.toString=function(){for(var a=[],c=0,d=this.rangeCount;c<d;++c)a[c]=""+this._ranges[c];return a.join("")};m.collapse=function(a,c){s(this,a);var d=b.createRange(q.getDocument(a));d.collapseToPoint(a,c);this.removeAllRanges();this.addRange(d);this.isCollapsed=!0};m.collapseToStart=function(){if(this.rangeCount){var a=
this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new x("INVALID_STATE_ERR");};m.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new x("INVALID_STATE_ERR");};m.selectAllChildren=function(a){s(this,a);var c=b.createRange(q.getDocument(a));c.selectNodeContents(a);this.removeAllRanges();this.addRange(c)};m.deleteFromDocument=function(){if(O&&L&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),
c;a.length;)c=a.item(0),a.remove(c),c.parentNode.removeChild(c);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();c=0;for(var d=a.length;c<d;++c)a[c].deleteContents();this.addRange(a[d-1])}};m.getAllRanges=function(){return this._ranges.slice(0)};m.setSingleRange=function(a){this.setRanges([a])};m.containsNode=function(a,c){for(var d=0,b=this._ranges.length;d<b;++d)if(this._ranges[d].containsNode(a,c))return!0;return!1};m.toHtml=function(){var a="";if(this.rangeCount){for(var a=
f.getRangeDocument(this._ranges[0]).createElement("div"),c=0,d=this._ranges.length;c<d;++c)a.appendChild(this._ranges[c].cloneContents());a=a.innerHTML}return a};m.getName=function(){return"WrappedSelection"};m.inspect=function(){return k(this)};m.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};r.inspect=k;b.Selection=r;b.selectionPrototype=m;b.addCreateMissingNativeApiListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return b.getSelection(this)});
a=null})});/*
 CSS Class Applier module for Rangy.
 Adds, removes and toggles CSS classes on Ranges and Selections

 Part of Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Depends on Rangy core.

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
*/
rangy123.createModule("CssClassApplier",function(b,F){function E(a,d){return a.className&&RegExp("(?:^|\\s)"+d+"(?:\\s|$)").test(a.className)}function y(a,d){a.className?E(a,d)||(a.className+=" "+d):a.className=d}function w(a){return a.split(/\s+/).sort().join(" ")}function u(a,d){return w(a.className)==w(d.className)}function A(a){for(var d=a.parentNode;a.hasChildNodes();)d.insertBefore(a.firstChild,a);d.removeChild(a)}function z(a,d){var b=a.cloneRange();b.selectNodeContents(d);var e=b.intersection(a),
e=e?e.toString():"";b.detach();return""!=e}function I(a){return a.getNodes([3],function(d){return z(a,d)})}function e(a,d){if(a.attributes.length!=d.attributes.length)return!1;for(var b=0,e=a.attributes.length,f,m;b<e;++b)if(f=a.attributes[b],m=f.name,"class"!=m&&(m=d.attributes.getNamedItem(m),f.specified!=m.specified||f.specified&&f.nodeValue!==m.nodeValue))return!1;return!0}function p(a,d){for(var b=0,e=a.attributes.length,f;b<e;++b)if(f=a.attributes[b].name,(!d||!x.arrayContains(d,f))&&a.attributes[b].specified&&
"class"!=f)return!0;return!1}function r(a){var d;return a&&1==a.nodeType&&((d=a.parentNode)&&9==d.nodeType&&"on"==d.designMode||G(a)&&!G(a.parentNode))}function t(a){return(G(a)||1!=a.nodeType&&G(a.parentNode))&&!r(a)}function s(a){return a&&1==a.nodeType&&!B.test(H(a,"display"))}function k(a){if(0==a.data.length)return!0;if(L.test(a.data))return!1;switch(H(a.parentNode,"whiteSpace")){case "pre":case "pre-wrap":case "-moz-pre-wrap":return!1;case "pre-line":if(/[\r\n]/.test(a.data))return!1}return s(a.previousSibling)||
s(a.nextSibling)}function q(a,d,b,e){var f,m=0==b;if(x.isAncestorOf(d,a))return a;if(x.isCharacterDataNode(d))if(0==b)b=x.getNodeIndex(d),d=d.parentNode;else if(b==d.length)b=x.getNodeIndex(d)+1,d=d.parentNode;else throw F.createError("splitNodeAt should not be called with offset in the middle of a data node ("+b+" in "+d.data);if(x.isCharacterDataNode(d)?0==b?d.previousSibling:b==d.length?d.nextSibling:1:0<b&&b<d.childNodes.length){if(!f){f=d.cloneNode(!1);for(f.id&&f.removeAttribute("id");m=d.childNodes[b];)f.appendChild(m);
x.insertAfter(f,d)}return d==a?f:q(a,f.parentNode,x.getNodeIndex(f),e)}return a!=d?(f=d.parentNode,d=x.getNodeIndex(d),m||d++,q(a,f,d,e)):a}function a(a){var d=a?"nextSibling":"previousSibling";return function(b,f){var k=b.parentNode,m=b[d];if(m){if(m&&3==m.nodeType)return m}else if(f&&(m=k[d])&&1==m.nodeType&&k.tagName==m.tagName&&u(k,m)&&e(k,m))return m[a?"firstChild":"lastChild"];return null}}function f(a){this.firstTextNode=(this.isElementMerge=1==a.nodeType)?a.lastChild:a;this.textNodes=[this.firstTextNode]}
function v(a,d,b){this.cssClass=a;var e,f,m=null;if("object"==typeof d&&null!==d){b=d.tagNames;m=d.elementProperties;for(e=0;f=N[e++];)d.hasOwnProperty(f)&&(this[f]=d[f]);e=d.normalize}else e=d;this.normalize="undefined"==typeof e?!0:e;this.attrExceptions=[];e=document.createElement(this.elementTagName);this.elementProperties={};for(var h in m)m.hasOwnProperty(h)&&(M.hasOwnProperty(h)&&(h=M[h]),e[h]=m[h],this.elementProperties[h]=e[h],this.attrExceptions.push(h));this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?
w(this.elementProperties.className+" "+a):a;this.applyToAnyTagName=!1;a=typeof b;if("string"==a)"*"==b?this.applyToAnyTagName=!0:this.tagNames=b.toLowerCase().replace(/^\s\s*/,"").replace(/\s\s*$/,"").split(/\s*,\s*/);else if("object"==a&&"number"==typeof b.length)for(this.tagNames=[],e=0,a=b.length;e<a;++e)"*"==b[e]?this.applyToAnyTagName=!0:this.tagNames.push(b[e].toLowerCase());else this.tagNames=[this.elementTagName]}b.requireModules(["WrappedSelection","WrappedRange"]);var x=b.dom,K=function(){function a(c,
b,e){return b&&e?" ":""}return function(d,b){d.className&&(d.className=d.className.replace(RegExp("(?:^|\\s)"+b+"(?:\\s|$)"),a))}}(),H;"undefined"!=typeof window.getComputedStyle?H=function(a,d){return x.getWindow(a).getComputedStyle(a,null)[d]}:"undefined"!=typeof document.documentElement.currentStyle?H=function(a,d){return a.currentStyle[d]}:F.fail("No means of obtaining computed style properties found");var G;(function(){G="boolean"==typeof document.createElement("div").isContentEditable?function(a){return a&&
1==a.nodeType&&a.isContentEditable}:function(a){return a&&1==a.nodeType&&"false"!=a.contentEditable?"true"==a.contentEditable||G(a.parentNode):!1}})();var B=/^inline(-block|-table)?$/i,L=/[^\r\n\t\f \u200B]/,P=a(!1),C=a(!0);f.prototype={doMerge:function(){for(var a=[],d,b,e=0,f=this.textNodes.length;e<f;++e)d=this.textNodes[e],b=d.parentNode,a[e]=d.data,e&&(b.removeChild(d),b.hasChildNodes()||b.parentNode.removeChild(b));return this.firstTextNode.data=a=a.join("")},getLength:function(){for(var a=
this.textNodes.length,d=0;a--;)d+=this.textNodes[a].length;return d},toString:function(){for(var a=[],d=0,b=this.textNodes.length;d<b;++d)a[d]="'"+this.textNodes[d].data+"'";return"[Merge("+a.join(",")+")]"}};var N=["elementTagName","ignoreWhiteSpace","applyToEditableOnly"],M={"class":"className"};v.prototype={elementTagName:"span",elementProperties:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,hasClass:function(a){return 1==a.nodeType&&x.arrayContains(this.tagNames,a.tagName.toLowerCase())&&E(a,
this.cssClass)},getSelfOrAncestorWithClass:function(a){for(;a;){if(this.hasClass(a,this.cssClass))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||t(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&3==a.nodeType&&k(a)},postApply:function(a,d,b){for(var e=a[0],k=a[a.length-1],m=[],h,p=e,q=k,r=0,t=k.length,g,l,s=0,u=a.length;s<u;++s)g=a[s],(l=P(g,!b))?(h||(h=new f(l),m.push(h)),h.textNodes.push(g),g===e&&(p=h.firstTextNode,r=p.length),
g===k&&(q=h.firstTextNode,t=h.getLength())):h=null;if(a=C(k,!b))h||(h=new f(k),m.push(h)),h.textNodes.push(a);if(m.length){s=0;for(u=m.length;s<u;++s)m[s].doMerge();d.setStart(p,r);d.setEnd(q,t)}},createContainer:function(a){a=a.createElement(this.elementTagName);for(var d in this.elementProperties)this.elementProperties.hasOwnProperty(d)&&a.setAttribute(d,this.elementProperties[d]);y(a,this.cssClass);return a},applyToTextNode:function(a){var d=a.parentNode;1==d.childNodes.length&&x.arrayContains(this.tagNames,
d.tagName.toLowerCase())?y(d,this.cssClass):(d=this.createContainer(x.getDocument(a)),a.parentNode.insertBefore(d,a),d.appendChild(a))},isRemovable:function(a){var d;if(d=a.tagName.toLowerCase()==this.elementTagName)if(d=w(a.className)==this.elementSortedClassName){var b;a:{d=this.elementProperties;for(b in d)if(d.hasOwnProperty(b)&&a[b]!==d[b]){b=!1;break a}b=!0}d=b&&!p(a,this.attrExceptions)&&this.isModifiable(a)}return d},undoToTextNode:function(a,d,b){d.containsNode(b)||(a=d.cloneRange(),a.selectNode(b),
a.isPointInRange(d.endContainer,d.endOffset)&&(q(b,d.endContainer,d.endOffset,[d]),d.setEndAfter(b)),a.isPointInRange(d.startContainer,d.startOffset)&&(b=q(b,d.startContainer,d.startOffset,[d])));this.isRemovable(b)?A(b):K(b,this.cssClass)},applyToRange:function(a){a.splitBoundaries();var d=I(a);if(d.length){for(var b,e=0,f=d.length;e<f;++e)b=d[e],this.isIgnorableWhiteSpaceNode(b)||(this.getSelfOrAncestorWithClass(b)||!this.isModifiable(b))||this.applyToTextNode(b);a.setStart(d[0],0);b=d[d.length-
1];a.setEnd(b,b.length);this.normalize&&this.postApply(d,a,!1)}},applyToSelection:function(a){a=a||window;a=b.getSelection(a);var d,e=a.getAllRanges();a.removeAllRanges();for(var f=e.length;f--;)d=e[f],this.applyToRange(d),a.addRange(d)},undoToRange:function(a){a.splitBoundaries();var b=I(a),e,f,k=b[b.length-1];if(b.length){for(var m=0,h=b.length;m<h;++m)e=b[m],(f=this.getSelfOrAncestorWithClass(e))&&this.isModifiable(e)&&this.undoToTextNode(e,a,f),a.setStart(b[0],0),a.setEnd(k,k.length);this.normalize&&
this.postApply(b,a,!0)}},undoToSelection:function(a){a=a||window;a=b.getSelection(a);var d=a.getAllRanges(),e;a.removeAllRanges();for(var f=0,k=d.length;f<k;++f)e=d[f],this.undoToRange(e),a.addRange(e)},getTextSelectedByRange:function(a,b){var e=b.cloneRange();e.selectNodeContents(a);var f=e.intersection(b),f=f?f.toString():"";e.detach();return f},isAppliedToRange:function(a){if(a.collapsed)return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);for(var b=a.getNodes([3]),e=0,f;f=b[e++];)if(!this.isIgnorableWhiteSpaceNode(f)&&
z(a,f)&&this.isModifiable(f)&&!this.getSelfOrAncestorWithClass(f))return!1;return!0},isAppliedToSelection:function(a){a=a||window;a=b.getSelection(a).getAllRanges();for(var d=a.length;d--;)if(!this.isAppliedToRange(a[d]))return!1;return!0},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},detach:function(){}};v.util={hasClass:E,addClass:y,removeClass:K,
hasSameClasses:u,replaceWithOwnChildren:A,elementsHaveSameNonClassAttributes:e,elementHasNonClassAttributes:p,splitNodeAt:q,isEditableElement:G,isEditingHost:r,isEditable:t};b.CssClassApplier=v;b.createCssClassApplier=function(a,b,e){return new v(a,b,e)}});
